<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricency - השוואת מחירים</title>
    <style>
        :root { --primary: #3b82f6; --success: #28a745; --dark: #343a40; --bg: #ffffff; }
        body { font-family: system-ui, -apple-system, sans-serif; background-color: #f4f4f4; margin: 0; padding-bottom: 50px; direction: rtl; }
        
        .header { background: #3b82f6; padding: 40px 20px; text-align: center; color: white; border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; }
        .header h1 { margin: 0; font-size: 32px; }
        .header p { margin: 10px 0 0; opacity: 0.9; }

        .main-content { padding: 15px; max-width: 500px; margin: -50px auto 0; }
        
        .search-card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); margin-bottom: 20px; text-align: center; }
        input { width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 12px; font-size: 18px; box-sizing: border-box; margin-bottom: 15px; text-align: center; }
        .btn-search { width: 100%; background: #4a80f0; color: white; border: none; padding: 18px; border-radius: 12px; font-size: 20px; font-weight: bold; cursor: pointer; }

        /* עיצוב כרטיס מוצר מהתמונה */
        .product-item { 
            background: white; 
            padding: 20px; 
            border-radius: 20px; 
            margin-bottom: 15px; 
            border: 2px solid #3b82f6; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            text-align: right;
        }
        
        /* עיצוב למוצר הכי זול */
        .product-item.cheapest { 
            border: 3px solid #28a745; 
            background: #f0fff4; 
        }

        .product-title { font-size: 19px; font-weight: bold; color: #000; display: block; margin-bottom: 5px; }
        .store-name { color: #666; font-size: 15px; display: block; }
        
        .price-tag { color: #28a745; font-size: 34px; font-weight: 800; margin: 15px 0; display: block; }

        .buy-link { 
            display: block; 
            width: 100%; 
            text-align: center; 
            background: #343a40; 
            color: white; 
            padding: 18px; 
            border-radius: 15px; 
            text-decoration: none; 
            font-size: 20px; 
            font-weight: bold; 
        }
        .cheapest .buy-link { background: #28a745; }

        .footer { text-align: center; padding: 30px; background: #2d2d2d; color: white; margin-top: 40px; }
        .btn-donate { background: #ffc107; color: black; padding: 15px 35px; border-radius: 12px; text-decoration: none; font-weight: bold; display: inline-block; font-size: 18px; margin-top: 15px; }
    </style>
</head>
<body>

    <header class="header">
        <h1>Pricency</h1>
        <p>נוצר על ידי מיכאל - השוואת מחירים וקופונים</p>
    </header>

    <main class="main-content">
        <section class="search-card">
            <input type="text" id="q" placeholder="מה תרצה לקנות בזול?">
            <button class="btn-search" onclick="run()">חפש את המחיר הכי זול</button>
        </section>

        <div id="results"></div>
    </main>

    <footer class="footer">
        <p>© כל הזכויות שמורות למיכאל</p>
        <a href="https://paypal.me/iareah" target="_blank" class="btn-donate">לתרומה ב-PayPal</a>
    </footer>

    <script>
        async function run() {
            const q = document.getElementById('q').value;
            const res = document.getElementById('results');
            const key = "f93468b7cf17169a9dd3584bc3c91fe10947b64b19e0cf52266a0aaa35775903";
            
            if (!q) return;
            
            res.innerHTML = "<p style='text-align:center; padding: 20px;'>סורק את כל האתרים בזמן אמת...</p>";

            try {
                // שימוש ב-Proxy שעוקף חסימות בכל סוגי הטלפונים והדפדפנים
                const api = `https://serpapi.com/search.json?engine=google_shopping&q=${encodeURIComponent(q)}&hl=he&gl=il&api_key=${key}`;
                const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(api)}`;
                
                const response = await fetch(proxyUrl);
                const json = await response.json();
                const data = JSON.parse(json.contents);

                if (data.shopping_results && data.shopping_results.length > 0) {
                    // מיון מהזול ליקר
                    const sorted = data.shopping_results.sort((a, b) => (a.extracted_price || 99999) - (b.extracted_price || 99999));
                    
                    res.innerHTML = "";
                    sorted.slice(0, 10).forEach((item, i) => {
                        const isMin = i === 0;
                        const price = item.extracted_price || "באתר";
                        
                        res.innerHTML += `
                            <div class="product-item ${isMin ? 'cheapest' : ''}">
                                <span class="product-title">${item.title}</span>
                                <span class="store-name">חנות: ${item.source}</span>
                                <span class="price-tag">₪${price}</span>
                                <a href="${item.link}" target="_blank" class="buy-link">עבור לחנות</a>
                            </div>`;
                    });
                } else {
                    res.innerHTML = "<p style='text-align:center;'>לא נמצאו תוצאות. נסה שם מוצר אחר.</p>";
                }
            } catch (e) {
                res.innerHTML = "<p style='text-align:center;'>שגיאת חיבור. נא לנסות שוב בעוד רגע.</p>";
            }
        }
    </script>
</body>
</html>
