<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pricency - השוואת מחירים</title>
    <style>
        :root { --primary: #3b82f6; --success: #28a745; --dark: #343a40; --bg: #ffffff; }
        body { font-family: system-ui, -apple-system, sans-serif; background-color: #f4f4f4; margin: 0; padding-bottom: 50px; }
        
        /* כותרת עליונה */
        .header { background: #ffffff; padding: 20px; text-align: center; border-bottom: 1px solid #ddd; }
        .header h1 { margin: 0; color: var(--primary); font-size: 24px; }

        .main-content { padding: 15px; max-width: 500px; margin: 0 auto; }
        
        /* תיבת חיפוש */
        .search-card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 20px; }
        input { width: 100%; padding: 15px; border: 1px solid #ccc; border-radius: 10px; font-size: 18px; box-sizing: border-box; margin-bottom: 15px; }
        .btn-search { width: 100%; background: var(--primary); color: white; border: none; padding: 15px; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; }

        /* כרטיס מוצר - העיצוב מהתמונה */
        .product-item { 
            background: white; 
            padding: 20px; 
            border-radius: 20px; 
            margin-bottom: 20px; 
            border: 2px solid #3b82f6; /* מסגרת כחולה כמו בתמונה */
            position: relative;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        
        /* הכרטיס הזול ביותר - מסגרת ירוקה ורקע בהיר */
        .product-item.cheapest { 
            border: 3px solid var(--success); 
            background: #f0fff4; 
        }

        .product-title { font-size: 18px; font-weight: bold; color: #000; margin-bottom: 5px; display: block; line-height: 1.4; }
        .store-name { color: #666; font-size: 14px; margin-bottom: 10px; display: block; }
        
        .price-row { display: flex; align-items: center; justify-content: flex-end; margin: 15px 0; }
        .price-tag { color: var(--success); font-size: 32px; font-weight: 800; }
        .currency { font-size: 24px; margin-left: 2px; }

        /* כפתור עבור לחנות */
        .buy-link { 
            display: block; 
            width: 100%; 
            text-align: center; 
            background: var(--dark); 
            color: white; 
            padding: 18px; 
            border-radius: 15px; 
            text-decoration: none; 
            font-size: 20px; 
            font-weight: bold; 
        }
        .cheapest .buy-link { background: var(--success); }

        /* כפתור תרומה */
        .footer { text-align: center; padding: 20px; }
        .btn-donate { background: #ffc107; color: black; padding: 12px 25px; border-radius: 10px; text-decoration: none; font-weight: bold; display: inline-block; }
    </style>
</head>
<body>

    <header class="header">
        <h1>Pricency</h1>
        <div style="font-size:14px; color: #666;">השוואת מחירים בזמן אמת</div>
    </header>

    <main class="main-content">
        <section class="search-card">
            <input type="text" id="q" placeholder="הקלד שם מוצר (למשל: S25 FE)">
            <button class="btn-search" onclick="run()">חפש עכשיו</button>
        </section>

        <div id="results"></div>
    </main>

    <div class="footer">
        <a href="https://paypal.me/iareah" target="_blank" class="btn-donate">לתרומה למיכאל ב-PayPal</a>
    </div>

    <script>
        async function run() {
            const q = document.getElementById('q').value;
            const res = document.getElementById('results');
            const key = "f93468b7cf17169a9dd3584bc3c91fe10947b64b19e0cf52266a0aaa35775903";
            
            if (!q) { alert("נא להזין שם מוצר"); return; }
            
            res.innerHTML = "<p style='text-align:center;'>מחפש עבורך את המחירים הכי זולים...</p>";

            try {
                // שימוש בכתובת ישירה - ללא פרוקסי שעושה בעיות
                const api = `https://serpapi.com/search.json?engine=google_shopping&q=${encodeURIComponent(q)}&hl=he&gl=il&api_key=${key}`;
                const response = await fetch(api);
                const data = await response.json();

                if (data.shopping_results && data.shopping_results.length > 0) {
                    // מיון לפי מחיר מהזול ליקר
                    const sorted = data.shopping_results.sort((a, b) => (a.extracted_price || 99999) - (b.extracted_price || 99999));
                    
                    res.innerHTML = "";
                    sorted.slice(0, 8).forEach((item, i) => {
                        const isMin = i === 0;
                        const price = item.extracted_price || "ללא מחיר";
                        
                        res.innerHTML += `
                            <div class="product-item ${isMin ? 'cheapest' : ''}">
                                <span class="product-title">${item.title}</span>
                                <span class="store-name">חנות: ${item.source}</span>
                                <div class="price-row">
                                    <span class="price-tag"><span class="currency">₪</span>${price}</span>
                                </div>
                                <a href="${item.link}" target="_blank" class="buy-link">עבור לחנות</a>
                            </div>`;
                    });
                } else {
                    res.innerHTML = "<p style='text-align:center;'>לא נמצאו תוצאות. נסה חיפוש אחר.</p>";
                }
            } catch (e) {
                res.innerHTML = "<p style='text-align:center; color:red;'>שגיאה בטעינת הנתונים. נסה שנית.</p>";
                console.error(e);
            }
        }
    </script>
</body>
</html>
